# This code includes scanning for bt device, connecting to a bt device and to send data to a bt device
from network import Bluetooth
import ubinascii
import time 
# Connecting to a device that is sending advertisements.
# what are advertisements? 
bluetooth = Bluetooth()
bluetooth.start_scan(-1)    # start scanning with no timeout

while True:
#    print(bluetooth.get_adv()) #show what are the nearby bt devices 
    
    adv = bluetooth.get_adv()
    ubinascii.hexlify(adv.mac)
   
    if adv &  bluetootht.resolve_adv_data(adv.data, Bluetooth.ADV_NAME_CMPL) == 'Device name':
        try:
            connection = bluetooth.connect(adv.mac)
            services = connection.services()
            for service in services:
               time.sleep(0.050)
               if type(service.uuid()) == bytes:
                   print('Reading chars from service = {}'.format(service.uuid()))
               else:
                   print('Reading chars from service = %x' % service.uuid())
               chars = service.characteristics()
               for char in chars:
                   if (char.properties() & Bluetooth.PROP_READ):
                       print('char {} value = {}'.format(char.uuid(), char.read()))
            conn.disconnect()
            break
        except:

            pass
        else:
            time.sleep(0.050)
            
#    print("Connected to device with addr = {}".format(ubinascii.hexlify(adv.mac)))
